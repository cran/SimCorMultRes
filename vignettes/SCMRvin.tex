\documentclass{article}
\title{Simulating Correlated Binary and Multinomial Responses with \textbf{SimCorMultRes}}
\author{Anestis Touloumis}
\usepackage{Sweave}
\usepackage{amsmath}
\usepackage{graphicx, verbatim}
\setlength{\textwidth}{6.5in} 
\setlength{\textheight}{9in}
\setlength{\oddsidemargin}{0in} 
\setlength{\evensidemargin}{0in}
\setlength{\topmargin}{-1.5cm}
\begin{document}
\input{SCMRvin-concordance}
%\VignetteIndexEntry{Simulating Correlated Binary and Multinomial Responses with SimCorMultRes}
\date{}
\maketitle
\section{Introduction}
The \textbf{R} package \textbf{SimCorMultRes} is suitable for simulation of correlated ordinal or nominal multinomial responses (with three or more response categories) and of correlated binary responses conditional on a model specification for the marginal probabilities, which is accomplished by extending existing threshold approaches that give rise to regression models for independent binary and multinomial responses. We describe some theoretical details of these approaches and we provide simple examples to illustrate the use of the core functions in \textbf{SimCorMultRes}.\\
\indent Let $Y_{it}$ be the binary or multinomial response for subject $i$ ($i=1,\ldots,N$) at the measurement occasion $t$ ($t=1,\ldots,T$), and let $\mathbf {x}_{it}$ be the associated covariates vector. Note that we assume that $Y_{it} \in \{0,1\}$ for binary responses and $Y_{it} \in \{1,2,\ldots,J\geq 3\}$ for multinomial responses. 
\section{Correlated Nominal Multinomial Responses}
The function \texttt{rmult.bcl()} simulates correlated nominal multinomial responses under the marginal baseline category logit model specification
\begin{equation}
\log \left(\frac{\Pr(Y_{it}=j |\mathbf {x}_{it})}{\Pr(Y_{it}=I |\mathbf {x}_{it})}\right)=(\beta_{t0j}-\beta_{t0J})+(\boldsymbol {\beta}_{tj}-\boldsymbol{\beta}_{tJ})^{\prime} \mathbf {x}_{it}=\beta^{\ast}_{t0j}+\boldsymbol{\beta}^{\ast\prime}_{tj}\mathbf {x}_{it},
\label{MBCLM}
\end{equation}
where $\beta_{t0j}$ and $\boldsymbol{\beta}_{tj}$ is the $j$-th response category specific intercept and parameter vector at the $t$-th measurement occasion respectively. The popular identifiability constraints $\beta_{t0J}=0$ and $\boldsymbol{\beta}_{tJ}=\mathbf {0}$ imply that $\beta^{\ast}_{t0j}=\beta_{t0j}$ and $\boldsymbol {\beta}^{\ast}_{tj}=\boldsymbol{\beta}_{tj}$ for all $j=1,\ldots,J-1$.\\
Define 
$$U_{itj}=\mu_{itj}+e_{itj},$$
where $\mu_{itj}=\beta_{0j}+\boldsymbol{\beta}_{tj}^{\prime} \mathbf {x}_{it}$ and where the random variables $\{e_{itj}\}$ satisfy the following conditions: 
\begin{enumerate}
\item Marginally, $e_{itj}$ follows a standard extreme value distribution for all $i$, $t$ and $j$.
\item Random variables associated with different subjects are independent. That is, the random variables $e_{i_1t_1j_1}$ and $e_{i_2t_2j_2}$ are independent provided that $i_1 \neq i_2$.
\item Category specific random variables for each subject at a given measurement occasion are independent, i.e., $e_{itj_1}$ and $e_{itj_2}$ are independent for all $i$, $t$ and $j_1\neq j_2$.
\end{enumerate}
It can be shown that using the threshold
$$Y_{it}=j \Leftrightarrow U_{itj}=\max \{U_{it1},\ldots,U_{itJ}\}$$
correlated nominal multinomial responses that satisfy the marginal baseline category logit model specification in (\ref{MBCLM}) are generated. The above threshold approach extends the principle of maximum random utility (McFadden, 1973) to correlated nominal multinomial responses.\\
\indent The function \texttt{rmult.bcl()} requires the user to provide the common cluster size $T$ (\texttt{clsize}), the number of nominal response categories $J$ (\texttt{ncategories}), the linear predictor of model~(\ref{MBCLM}) in a matrix form (\texttt{lin.pred}) and the correlation matrix in the multivariate normal distribution of the NORTA method (\texttt{cor.matrix}). The \texttt{lin.pred} argument should be an $N \times (TJ)$ matrix such that the $i$-th row has elements $(\mu_{i11},\ldots,\mu_{i1J},\mu_{i21},\ldots,\mu_{i2J},\cdots,\mu_{iT1},\ldots,\mu_{iTJ})$.\\
\indent For example, suppose that we want to simulate nominal multinomial responses under a marginal baseline category logit model with $N=500$, $J=4$, $T=3$, $(\beta_{t01},\beta_{t02},\beta_{t03},\beta_{t04})=(\beta_{01},\beta_{02},\beta_{03},\beta_{04})=(1,3,5,0)$ and $\boldsymbol \beta_t=\boldsymbol \beta=(\beta_{1},\beta_{2},\beta_{3},\beta_{4})=(2,4,6,0)$ for all $t$, and a time-stationary covariate for each subject drawn from a standard normal distribution. For the sake of simplicity, suppose that $\{e_{itj}\}$ are independent. The following \textbf{R} code is used to simulate nominal multinomial responses under this sampling scheme
\begin{Schunk}
\begin{Sinput}
> library("SimCorMultRes")
> set.seed(1)
> N <- 500
> ncategories <- 4
> clsize <- 3
> Xmat <- matrix(rnorm(N),N,ncategories)
> betas <- c(1,2,3,4,5,6)
> lin.pred <- matrix(c(betas[c(2,4,6)],0),N,4,byrow=TRUE)*Xmat+
+            matrix(c(betas[c(1,3,5)],0),N,4,byrow=TRUE)
> lin.pred <- matrix(lin.pred,N,ncategories*clsize)
> cor.matrix <- diag(1,12)
> Y <- rmult.bcl(clsize,ncategories,lin.pred,cor.matrix)
\end{Sinput}
\end{Schunk}
The simulated clustered nominal multinomial responses for the first six subjects are
\begin{Schunk}
\begin{Sinput}
> head(Y$Ysim)
\end{Sinput}
\begin{Soutput}
     [,1] [,2] [,3]
[1,]    3    3    1
[2,]    2    3    3
[3,]    4    2    3
[4,]    3    3    3
[5,]    3    3    3
[6,]    1    1    3
\end{Soutput}
\end{Schunk}
\section{Correlated Ordinal Multinomial Responses}
Generation of correlated ordinal multinomial responses is feasible under either a marginal cumulative link model or a marginal continuation ratio model specification.
\subsection{Marginal cumulative link model}
The function \texttt{rmult.clm()} simulates correlated ordinal multinomial responses under the marginal cumulative link model specification
\begin{equation}
\Pr(Y_{it}\le j |\mathbf {x}_{it})=F(\beta_{t0j} +\boldsymbol {\beta}^{\prime}_t \mathbf {x}_{it})
\label{MCLM}
\end{equation}
where $\beta_{t0j}$ is the $j$-th category specific intercept at the $t$-th measurement occasion and $\boldsymbol \beta_t$ is the parameter vector at the $t$-th measurement occasion, and $F$ is a cumulative distribution function. The response category specific intercepts are assumed to be monotone increasing, that is
$$-\infty=\beta_{t00} <\beta_{t01} < \beta_{t02} < \cdots < \beta_{t0(J-1)}< \beta_{t0J}=\infty$$
for all $t$. Define
$$U_{it}=\mu_{it}+e_{it},$$
where $\mu_{it}=\boldsymbol{\beta}^{\prime}_t \mathbf {x}_{it}$ and where the random variables $\{e_{it}\}$ satisfy the following conditions:
\begin{enumerate}
\item Marginally, $e_{it}$ follows the distribution specified by $F$ for all $i$ and $t$.
\item Random variables associated with different subjects are independent, i.e., the random variables $e_{i_1t_1}$ and $e_{i_2t_2}$ are independent for all $i_1 \neq i_2$.
\end{enumerate}
It can be shown that using the threshold
$$Y_{it}=j \Leftrightarrow \beta_{t0(j-1)} < U_{it} \leq \beta_{t0j}$$
correlated ordinal multinomial responses under the marginal cumulative link model specification in (\ref{MCLM}) are generated. This threshold extends the approach of McCullagh (1980) to generating correlated multinomial responses.\\
\indent The function \texttt{rmult.clm()} requires the user to provide the common cluster size $T$ (\texttt{clsize}), the linear predictor of model~(\ref{MCLM}) excluding the response category intercepts in a matrix form (\texttt{lin.pred}), the correlation matrix in the multivariate normal distribution of the NORTA method (\texttt{cor.matrix}), the response category specific intercepts $\beta_{0tj}$'s (\texttt{intercepts}) and the cumulative distribution function $F$ (\texttt{link}). The \texttt{lin.pred} argument should be an $N \times T$ matrix such that the $i$-th row has elements $(\mu_{i1},\mu_{i2},\cdots,\mu_{iT})$.\\
\indent For example, suppose that we want to simulate correlated ordinal multinomial responses from a marginal cumulative probit model with $N=500$, $J=5$, $T=4$, $(\beta_{t01},\beta_{t02},\beta_{t03},\beta_{t04})=(\beta_{01},\beta_{02},\beta_{03},\beta_{04})=(-1.5,-0.5,0.5,1.5)$ and $\boldsymbol \beta_t=\beta=1$ for all $t$, a single time-stationary covariate for each subject drawn from a standard normal distribution and a latent correlation matrix equal to
$$\left( {\begin{array}{*{20}c}
   1.00 & 0.85 & 0.50 & 0.15  \\
   0.85 & 1.00 & 0.85 & 0.50  \\
   0.50 & 0.15 & 1.00 & 0.85 \\
   0.15 & 0.85 & 0.50 & 1.00
 \end{array} } \right)$$
The following \textbf{R} code generates the clustered ordinal multinomial responses under this configuration
\begin{Schunk}
\begin{Sinput}
> set.seed(12345)
> N <- 500
> clsize <- 4
> intercepts <- c(-1.5,-0.5,0.5,1.5)
> cor.matrix <- toeplitz(c(1,0.85,0.5,0.15))
> lin.pred <- rsmvnorm(N,toeplitz(c(1,rep(0.85,clsize-1))))
> Y <- rmult.clm(clsize,lin.pred,cor.matrix,intercepts,"probit")
\end{Sinput}
\end{Schunk}
The simulated clustered ordinal multinomial responses for the first six subjects are 
\begin{Schunk}
\begin{Sinput}
> head(Y$Ysim)
\end{Sinput}
\begin{Soutput}
     [,1] [,2] [,3] [,4]
[1,]    2    2    1    2
[2,]    3    5    4    3
[3,]    3    2    3    3
[4,]    5    4    3    3
[5,]    4    2    2    3
[6,]    5    5    5    5
\end{Soutput}
\end{Schunk}

\subsection{Marginal continuation ratio model}
The function \texttt{rmult.crm()} simulates correlated ordinal multinomial responses under the marginal continuation ratio model specification
\begin{equation}
\Pr(Y_{it}=j |Y_{it} \ge j,\mathbf {x}_{it})=F(\beta_{t0j} +\boldsymbol {\beta}^{'}_t \mathbf {x}_{it})
\label{MCRM}
\end{equation}
where $\beta_{t0j}$ and $\boldsymbol \beta_t$ is the $j$-th category specific intercept and the parameter vector at the $t$-th measurement occasion respectively, and $F$ is a cumulative distribution function. The response category specific intercepts are assumed to be monotone increasing at each measurement occasion, that is
$$-\infty=\beta_{t00} <\beta_{t01} < \beta_{t02} < \ldots < \beta_{t0(J-1)}< \beta_{t0J}=\infty$$
for all $t$.
Define 
$$U_{itj}=\mu_{it}+e_{itj},$$
where $\mu_{it}=\boldsymbol {\beta}^{\prime}_t \mathbf {x}_{it}$ and where the random variables $\{e_{itj}\}$ satisfy the following conditions:
\begin{enumerate}
\item Marginally, $e_{itj}$ follows the distribution specified by $F$ for all $i$, $t$ and $j$.
\item Random variables associated with different subjects are independent, i.e., the random variables $e_{i_1t_1j_1}$ and $e_{i_2t_2j_2}$ are independent for all $i_1 \neq i_2$.
\item The category specific random variables for each subject at a given measurement occasion are independent, i.e., the random variables $e_{itj_1}$ and $e_{itj_2}$ are independent for all $j_1\neq j_2$.
\end{enumerate}
It can be shown that using the threshold
$$Y_{it}=j, \text{ given } Y_{it} \geq j \Leftrightarrow U_{itj} \leq \beta_{t0j}$$
correlated ordinal multinomial responses that satisfy the marginal continuation ratio model specification in (\ref{MCRM}) are generated. This approach extends the latent variable representation described in Tutz (1991) to generating correlated multinomial responses.\\
\indent The function \texttt{rmult.crm()} requires the user to provide the common cluster size $T$ (\texttt{clsize}), the linear predictor of model~(\ref{MCRM}) excluding the response category intercepts in a matrix form (\texttt{lin.pred}), the correlation matrix of the multivariate normal distribution in the NORTA method (\texttt{cor.matrix}), the category specific intercepts $\beta_{0j}$'s (\texttt{intercepts}) and the cumulative distribution function $F$ (\texttt{link}). The \texttt{lin.pred} argument should be an $N \times T$ matrix such that the $i$-th row has elements $(\mu_{i1},\mu_{i2},\cdots,\mu_{iT})$.\\
\indent For example, suppose that we want to simulate ordinal multinomial responses under a marginal continuation ratio probit model with $N=500$, $J=5$, $T=4$, $(\beta_{t01},\beta_{t02},\beta_{t03},\beta_{t04})=(\beta_{01},\beta_{02},\beta_{03},\beta_{04})=(-1.5,-0.5,0.5,1.5)$ and $\boldsymbol \beta_t=\beta=1$ for all $t$ and a single time-stationary covariate for each subject drawn from a standard normal distribution. To simplify matters further, suppose that $\{e_{itj}\}$ are independent. The following \textbf{R} code generates the clustered ordinal multinomial responses under this configuration
\begin{Schunk}
\begin{Sinput}
> set.seed(1)
> N <- 500
> clsize <- 4
> intercepts <- c(-1.5,-0.5,0.5,1.5)
> cor.matrix <- diag(1,16)
> x <- rnorm(N)
> lin.pred <- matrix(rep(x,clsize),N,clsize,byrow=TRUE)
> Y <- rmult.crm(clsize,lin.pred,cor.matrix,intercepts,link="probit")
\end{Sinput}
\end{Schunk}
The simulated clustered ordinal multinomial responses for the first six subjects are 
\begin{Schunk}
\begin{Sinput}
> head(Y$Ysim)
\end{Sinput}
\begin{Soutput}
     [,1] [,2] [,3] [,4]
[1,]    2    5    2    3
[2,]    5    5    2    4
[3,]    2    5    5    4
[4,]    2    4    3    1
[5,]    5    4    2    5
[6,]    1    5    5    5
\end{Soutput}
\end{Schunk}

\section{Correlated Binary Responses}
The function \texttt{rbin()} simulates correlated binary responses under the marginal model
\begin{equation}
\Pr(Y_{it}=1 |\mathbf {x}_{it})=F(\beta_{t0} +\boldsymbol {\beta}^{\prime}_{t} \mathbf {x}_{it})
\label{MB}
\end{equation}
where $\beta_{t0}$ and $\boldsymbol \beta_t$ is the intercept and the parameter vector at the $t$-th measurement occasion respectively, and $F$ is a cumulative distribution function.\\
For subject $i$, define $\mu_{it}=\boldsymbol{\beta}^{\prime}_t \mathbf {x}_{it}$ and define the random variables $\{e_{it}\}$ such that:
\begin{enumerate}
\item Marginally, $e_{it}$ follows the distribution specified by $F$ for all $i$ and $t$.
\item Random variables associated with different subjects are independent, i.e., the random variables $e_{i_1t_1}$ and $e_{i_2t_2}$ are independent for all $i_1 \neq i_2$.
\end{enumerate}
It can be shown that using the threshold
$$Y_{it}=I(e_{it} \leq \beta_{t0}+\mu_{it}),$$
correlated binary responses under the marginal model specification in (\ref{MB}) are generated. Here, $I(A)$ is the indicator function of the event $A$.\\
\indent The function \texttt{rbin()} requires the user to provide the common cluster size $T$ (\texttt{clsize}), the linear predictor of model~(\ref{MB}) excluding the intercept in a matrix form (\texttt{lin.pred}), the correlation matrix in the multivariate normal distribution of the NORTA method (\texttt{cor.matrix}), the intercepts $\beta_{01},\ldots, \beta_{0T}$ (\texttt{intercepts}) and the cumulative distribution function $F$ (\texttt{link}). The \texttt{lin.pred} argument should be an $N \times T$ matrix such that the $i$-th row has elements $(\mu_{i1},\mu_{i2},\cdots,\mu_{iT})$.\\
\indent For example, suppose that we want to simulate correlated binary responses from a marginal cumulative probit model with $N=500$, $J=5$, $\beta_{t0}=\beta_{0}=1$ and $\boldsymbol \beta_t=\beta=1$ for all $t$, a single time-stationary covariate for each subject drawn from a standard normal distribution and a latent correlation matrix equal to
$$\left( {\begin{array}{*{20}c}
   1.00 & 0.85 & 0.50 & 0.15  \\
   0.85 & 1.00 & 0.85 & 0.50  \\
   0.50 & 0.15 & 1.00 & 0.85 \\
   0.15 & 0.85 & 0.50 & 1.00
 \end{array} } \right)$$
The following \textbf{R} code generates the clustered binary responses under this configuration
\begin{Schunk}
\begin{Sinput}
> set.seed(1)
> N <- 500
> clsize <- 4
> intercepts <- 1
> cor.matrix <- toeplitz(c(1,0.85,0.5,0.15))
> lin.pred <- matrix(rnorm(N),N,clsize)
> Y <- rbin(clsize,lin.pred,cor.matrix,intercepts,"probit")   
\end{Sinput}
\end{Schunk}
The simulated clustered binary responses for the first six subjects are 
\begin{Schunk}
\begin{Sinput}
> head(Y$Ysim)
\end{Sinput}
\begin{Soutput}
     [,1] [,2] [,3] [,4]
[1,]    1    0    0    0
[2,]    1    1    1    1
[3,]    1    1    1    0
[4,]    1    1    1    1
[5,]    1    1    1    1
[6,]    0    0    1    1
\end{Soutput}
\end{Schunk}
  \begin{thebibliography}{1}
\bibitem{}  McCullagh, P. (1980). Regression models for ordinal data. \textit{Journal of the Royal Statistical Society B}, \textbf{42}, 109--142.

\bibitem{}  McFadden, D. (1974). \textit{Conditional logit analysis of qualitative choice behavior}. New York: Academic Press, 105--142.

\bibitem{}  Tutz, G. (1991). Sequential models in categorical regression, \textit{Computational Statistics \& Data Analysis}, \textbf{11}, 27--295.
  \end{thebibliography}
\end{document}

